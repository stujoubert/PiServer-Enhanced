{% extends "layout.html" %}
{% block content %}

<style>
.card-modern {
    background: #ffffff;
    border-radius: 14px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    padding: 20px;
}

.btn-modern {
    border-radius: 8px;
    padding: 6px 16px;
    font-weight: 600;
}

.face-preview {
    max-width: 160px;
    border-radius: 10px;
    border: 1px solid #ddd;
    margin-bottom: 10px;
}
</style>

<div class="card-modern">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="fw-bold">
            {{ T.edit_user or 'Edit User' }}
        </h3>

        <a href="{{ url_for('users.users_list') }}"
           class="btn btn-outline-secondary btn-modern">
            ‚Üê {{ T.back_to_users or 'Back to Users' }}
        </a>
    </div>

    <!-- ===================== -->
    <!-- USER BASIC INFO FORM -->
    <!-- ===================== -->
    <form method="post"
          action="{{ url_for('users.users_edit', employee_id=user.employee_id) }}">

        <div class="row g-3">

            <div class="col-md-4">
                <label class="form-label">
                    {{ T.employee_id or 'Employee ID' }}
                </label>
                <input type="text"
                       class="form-control"
                       value="{{ user.employee_id }}"
                       disabled>
            </div>

            <div class="col-md-4">
                <label class="form-label">
                    {{ T.name or 'Name' }}
                </label>
                <input type="text"
                       name="name"
                       class="form-control"
                       value="{{ user.name }}"
                       required>
            </div>

            {% if devices %}
            <div class="col-md-4">
                <label class="form-label">
                    {{ T.device_name or 'Device' }}
                </label>
                <select name="device_id" class="form-select">
                    {% for d in devices %}
                        <option value="{{ d[0] }}"
                                {% if d[0] == user.device_id %}selected{% endif %}>
                            {{ d[1] }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}

        </div>

        <button class="btn btn-success btn-modern mt-3">
            {{ T.update_user or 'Update User' }}
        </button>
    </form>

    <!-- ===================== -->
    <!-- FACE ENROLLMENT -->
    <!-- ===================== -->
    <hr class="my-4">

    <h4 class="fw-bold mb-3">
        {{ T.face_enrollment or 'Face Enrollment' }}
    </h4>

    {% if user.face_image %}
        <div class="mb-3">
            <img src="{{ url_for('users.user_face', employee_id=user.employee_id) }}"
                 class="face-preview">

            <div class="text-muted small">
                {{ T.source or 'Source' }}:
                {{ user.face_source or 'unknown' }}<br>
                {{ T.updated or 'Updated' }}:
                {{ user.face_updated_at or 'unknown' }}
            </div>
        </div>
    {% else %}
        <p class="text-warning mb-3">
            {{ T.no_face_image or 'No face image stored for this user.' }}
        </p>
    {% endif %}

    <!-- Upload face image -->
    {% if user.face_image is none %}
    <form method="post"
          action="{{ url_for('users.upload_face', employee_id=user.employee_id) }}"
          enctype="multipart/form-data"
          class="mb-3">

        <label class="form-label">
            {{ T.upload_face_image or 'Upload face image (JPG / PNG)' }}
        </label>
        <input type="file"
               name="face"
               accept="image/jpeg,image/png"
               class="form-control"
               required>

        <button class="btn btn-primary btn-modern mt-2">
            {{ T.upload_face or 'Upload Face' }}
        </button>
    </form>
    {% endif %}

    <!-- Use snapshot -->
    {% if user.face_image is none %}
    <form method="post"
          action="{{ url_for('users.use_snapshot', employee_id=user.employee_id) }}"
          onsubmit="return confirm('{{ T.confirm_use_snapshot or 'Use latest access snapshot as face image?' }}');">

        <button class="btn btn-outline-warning btn-modern">
            {{ T.use_event_snapshot or 'Use Event Snapshot as Face' }}
        </button>
    </form>
    {% endif %}

</div>

{% endblock %}
